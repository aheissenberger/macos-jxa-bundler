var e=require("fs"),t=require("constants"),n=require("stream"),r=require("util"),o=require("assert"),i=require("path"),c=require("os"),s=require("kleur"),a=require("child_process"),u=require("cross-spawn");function l(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var f=l(e),d=l(t),p=l(n),y=l(r),h=l(o),m=l(i),S=l(c),v=l(s),g=l(u);function E(){return(E=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var w="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function b(e){var t={exports:{}};return e(t,t.exports),t.exports}var k=function(e){return Object.defineProperty(function(){if("function"!=typeof arguments[arguments.length-1])return new Promise((t,n)=>{arguments[arguments.length]=(e,r)=>{if(e)return n(e);t(r)},arguments.length++,e.apply(this,arguments)});e.apply(this,arguments)},"name",{value:e.name})},O=process.cwd,j=null,N=process.env.GRACEFUL_FS_PLATFORM||process.platform;process.cwd=function(){return j||(j=O.call(process)),j};try{process.cwd()}catch(e){}if("function"==typeof process.chdir){var F=process.chdir;process.chdir=function(e){j=null,F.call(process,e)},Object.setPrototypeOf&&Object.setPrototypeOf(process.chdir,F)}var x=p.default.Stream,P=Object.getPrototypeOf||function(e){return e.__proto__},D=b(function(e){var t,n;function r(e,n){Object.defineProperty(e,t,{get:function(){return n}})}"function"==typeof Symbol&&"function"==typeof Symbol.for?(t=Symbol.for("graceful-fs.queue"),n=Symbol.for("graceful-fs.previous")):(t="___graceful-fs.queue",n="___graceful-fs.previous");var o=function(){};function i(e){(function(e){var t,n;function r(t){return t?function(n,r,o){return t.call(e,n,r,function(e){u(e)&&(e=null),o&&o.apply(this,arguments)})}:t}function o(t){return t?function(n,r){try{return t.call(e,n,r)}catch(e){if(!u(e))throw e}}:t}function i(t){return t?function(n,r,o,i){return t.call(e,n,r,o,function(e){u(e)&&(e=null),i&&i.apply(this,arguments)})}:t}function c(t){return t?function(n,r,o){try{return t.call(e,n,r,o)}catch(e){if(!u(e))throw e}}:t}function s(t){return t?function(n,r,o){function i(e,t){t&&(t.uid<0&&(t.uid+=4294967296),t.gid<0&&(t.gid+=4294967296)),o&&o.apply(this,arguments)}return"function"==typeof r&&(o=r,r=null),r?t.call(e,n,r,i):t.call(e,n,i)}:t}function a(t){return t?function(n,r){var o=r?t.call(e,n,r):t.call(e,n);return o.uid<0&&(o.uid+=4294967296),o.gid<0&&(o.gid+=4294967296),o}:t}function u(e){return!e||"ENOSYS"===e.code||!(process.getuid&&0===process.getuid()||"EINVAL"!==e.code&&"EPERM"!==e.code)}d.default.hasOwnProperty("O_SYMLINK")&&process.version.match(/^v0\.6\.[0-2]|^v0\.5\./)&&function(e){e.lchmod=function(t,n,r){e.open(t,d.default.O_WRONLY|d.default.O_SYMLINK,n,function(t,o){t?r&&r(t):e.fchmod(o,n,function(t){e.close(o,function(e){r&&r(t||e)})})})},e.lchmodSync=function(t,n){var r,o=e.openSync(t,d.default.O_WRONLY|d.default.O_SYMLINK,n),i=!0;try{r=e.fchmodSync(o,n),i=!1}finally{if(i)try{e.closeSync(o)}catch(e){}else e.closeSync(o)}return r}}(e),e.lutimes||function(e){d.default.hasOwnProperty("O_SYMLINK")?(e.lutimes=function(t,n,r,o){e.open(t,d.default.O_SYMLINK,function(t,i){t?o&&o(t):e.futimes(i,n,r,function(t){e.close(i,function(e){o&&o(t||e)})})})},e.lutimesSync=function(t,n,r){var o,i=e.openSync(t,d.default.O_SYMLINK),c=!0;try{o=e.futimesSync(i,n,r),c=!1}finally{if(c)try{e.closeSync(i)}catch(e){}else e.closeSync(i)}return o}):(e.lutimes=function(e,t,n,r){r&&process.nextTick(r)},e.lutimesSync=function(){})}(e),e.chown=i(e.chown),e.fchown=i(e.fchown),e.lchown=i(e.lchown),e.chmod=r(e.chmod),e.fchmod=r(e.fchmod),e.lchmod=r(e.lchmod),e.chownSync=c(e.chownSync),e.fchownSync=c(e.fchownSync),e.lchownSync=c(e.lchownSync),e.chmodSync=o(e.chmodSync),e.fchmodSync=o(e.fchmodSync),e.lchmodSync=o(e.lchmodSync),e.stat=s(e.stat),e.fstat=s(e.fstat),e.lstat=s(e.lstat),e.statSync=a(e.statSync),e.fstatSync=a(e.fstatSync),e.lstatSync=a(e.lstatSync),e.lchmod||(e.lchmod=function(e,t,n){n&&process.nextTick(n)},e.lchmodSync=function(){}),e.lchown||(e.lchown=function(e,t,n,r){r&&process.nextTick(r)},e.lchownSync=function(){}),"win32"===N&&(e.rename=(t=e.rename,function(n,r,o){var i=Date.now(),c=0;t(n,r,function s(a){if(a&&("EACCES"===a.code||"EPERM"===a.code)&&Date.now()-i<6e4)return setTimeout(function(){e.stat(r,function(e,i){e&&"ENOENT"===e.code?t(n,r,s):o(a)})},c),void(c<100&&(c+=10));o&&o(a)})})),e.read=function(t){function n(n,r,o,i,c,s){var a;if(s&&"function"==typeof s){var u=0;a=function(l,f,d){if(l&&"EAGAIN"===l.code&&u<10)return u++,t.call(e,n,r,o,i,c,a);s.apply(this,arguments)}}return t.call(e,n,r,o,i,c,a)}return Object.setPrototypeOf&&Object.setPrototypeOf(n,t),n}(e.read),e.readSync=(n=e.readSync,function(t,r,o,i,c){for(var s=0;;)try{return n.call(e,t,r,o,i,c)}catch(e){if("EAGAIN"===e.code&&s<10){s++;continue}throw e}})})(e),e.gracefulify=i,e.createReadStream=function(t,n){return new e.ReadStream(t,n)},e.createWriteStream=function(t,n){return new e.WriteStream(t,n)};var t=e.readFile;e.readFile=function(e,n,r){return"function"==typeof n&&(r=n,n=null),function e(n,r,o){return t(n,r,function(t){!t||"EMFILE"!==t.code&&"ENFILE"!==t.code?("function"==typeof o&&o.apply(this,arguments),s()):c([e,[n,r,o]])})}(e,n,r)};var n=e.writeFile;e.writeFile=function(e,t,r,o){return"function"==typeof r&&(o=r,r=null),function e(t,r,o,i){return n(t,r,o,function(n){!n||"EMFILE"!==n.code&&"ENFILE"!==n.code?("function"==typeof i&&i.apply(this,arguments),s()):c([e,[t,r,o,i]])})}(e,t,r,o)};var r=e.appendFile;r&&(e.appendFile=function(e,t,n,o){return"function"==typeof n&&(o=n,n=null),function e(t,n,o,i){return r(t,n,o,function(r){!r||"EMFILE"!==r.code&&"ENFILE"!==r.code?("function"==typeof i&&i.apply(this,arguments),s()):c([e,[t,n,o,i]])})}(e,t,n,o)});var o=e.copyFile;o&&(e.copyFile=function(e,t,n,r){return"function"==typeof n&&(r=n,n=0),o(e,t,n,function(i){!i||"EMFILE"!==i.code&&"ENFILE"!==i.code?("function"==typeof r&&r.apply(this,arguments),s()):c([o,[e,t,n,r]])})});var a=e.readdir;function u(t){return a.apply(e,t)}if(e.readdir=function(e,t,n){var r=[e];return"function"!=typeof t?r.push(t):n=t,r.push(function(e,t){t&&t.sort&&t.sort(),!e||"EMFILE"!==e.code&&"ENFILE"!==e.code?("function"==typeof n&&n.apply(this,arguments),s()):c([u,[r]])}),u(r)},"v0.8"===process.version.substr(0,4)){var l=function(e){return{ReadStream:function t(n,r){if(!(this instanceof t))return new t(n,r);x.call(this);var o=this;this.path=n,this.fd=null,this.readable=!0,this.paused=!1,this.flags="r",this.mode=438,this.bufferSize=65536,r=r||{};for(var i=Object.keys(r),c=0,s=i.length;c<s;c++){var a=i[c];this[a]=r[a]}if(this.encoding&&this.setEncoding(this.encoding),void 0!==this.start){if("number"!=typeof this.start)throw TypeError("start must be a Number");if(void 0===this.end)this.end=Infinity;else if("number"!=typeof this.end)throw TypeError("end must be a Number");if(this.start>this.end)throw new Error("start must be <= end");this.pos=this.start}null===this.fd?e.open(this.path,this.flags,this.mode,function(e,t){if(e)return o.emit("error",e),void(o.readable=!1);o.fd=t,o.emit("open",t),o._read()}):process.nextTick(function(){o._read()})},WriteStream:function t(n,r){if(!(this instanceof t))return new t(n,r);x.call(this),this.path=n,this.fd=null,this.writable=!0,this.flags="w",this.encoding="binary",this.mode=438,this.bytesWritten=0,r=r||{};for(var o=Object.keys(r),i=0,c=o.length;i<c;i++){var s=o[i];this[s]=r[s]}if(void 0!==this.start){if("number"!=typeof this.start)throw TypeError("start must be a Number");if(this.start<0)throw new Error("start must be >= zero");this.pos=this.start}this.busy=!1,this._queue=[],null===this.fd&&(this._open=e.open,this._queue.push([this._open,this.path,this.flags,this.mode,void 0]),this.flush())}}}(e);m=l.ReadStream,S=l.WriteStream}var f=e.ReadStream;f&&(m.prototype=Object.create(f.prototype),m.prototype.open=function(){var e=this;g(e.path,e.flags,e.mode,function(t,n){t?(e.autoClose&&e.destroy(),e.emit("error",t)):(e.fd=n,e.emit("open",n),e.read())})});var p=e.WriteStream;p&&(S.prototype=Object.create(p.prototype),S.prototype.open=function(){var e=this;g(e.path,e.flags,e.mode,function(t,n){t?(e.destroy(),e.emit("error",t)):(e.fd=n,e.emit("open",n))})}),Object.defineProperty(e,"ReadStream",{get:function(){return m},set:function(e){m=e},enumerable:!0,configurable:!0}),Object.defineProperty(e,"WriteStream",{get:function(){return S},set:function(e){S=e},enumerable:!0,configurable:!0});var y=m;Object.defineProperty(e,"FileReadStream",{get:function(){return y},set:function(e){y=e},enumerable:!0,configurable:!0});var h=S;function m(e,t){return this instanceof m?(f.apply(this,arguments),this):m.apply(Object.create(m.prototype),arguments)}function S(e,t){return this instanceof S?(p.apply(this,arguments),this):S.apply(Object.create(S.prototype),arguments)}Object.defineProperty(e,"FileWriteStream",{get:function(){return h},set:function(e){h=e},enumerable:!0,configurable:!0});var v=e.open;function g(e,t,n,r){return"function"==typeof n&&(r=n,n=null),function e(t,n,r,o){return v(t,n,r,function(i,a){!i||"EMFILE"!==i.code&&"ENFILE"!==i.code?("function"==typeof o&&o.apply(this,arguments),s()):c([e,[t,n,r,o]])})}(e,t,n,r)}return e.open=g,e}function c(e){o("ENQUEUE",e[0].name,e[1]),f.default[t].push(e)}function s(){var e=f.default[t].shift();e&&(o("RETRY",e[0].name,e[1]),e[0].apply(null,e[1]))}y.default.debuglog?o=y.default.debuglog("gfs4"):/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&(o=function(){var e=y.default.format.apply(y.default,arguments);e="GFS4: "+e.split(/\n/).join("\nGFS4: "),console.error(e)}),f.default[t]||(r(f.default,w[t]||[]),f.default.close=function(e){function t(t,n){return e.call(f.default,t,function(e){e||s(),"function"==typeof n&&n.apply(this,arguments)})}return Object.defineProperty(t,n,{value:e}),t}(f.default.close),f.default.closeSync=function(e){function t(t){e.apply(f.default,arguments),s()}return Object.defineProperty(t,n,{value:e}),t}(f.default.closeSync),/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&process.on("exit",function(){o(f.default[t]),h.default.equal(f.default[t].length,0)})),w[t]||r(w,f.default[t]),e.exports=i(function(e){if(null===e||"object"!=typeof e)return e;if(e instanceof Object)var t={__proto__:P(e)};else t=Object.create(null);return Object.getOwnPropertyNames(e).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}),t}(f.default)),process.env.TEST_GRACEFUL_FS_GLOBAL_PATCH&&!f.default.__patched&&(e.exports=i(f.default),f.default.__patched=!0)}),T=b(function(e,t){const n=k,r=["access","appendFile","chmod","chown","close","copyFile","fchmod","fchown","fdatasync","fstat","fsync","ftruncate","futimes","lchown","lchmod","link","lstat","mkdir","mkdtemp","open","readFile","readdir","readlink","realpath","rename","rmdir","stat","symlink","truncate","unlink","utimes","writeFile"].filter(e=>"function"==typeof D[e]);Object.keys(D).forEach(e=>{"promises"!==e&&(t[e]=D[e])}),r.forEach(e=>{t[e]=n(D[e])}),t.exists=function(e,t){return"function"==typeof t?D.exists(e,t):new Promise(t=>D.exists(e,t))},t.read=function(e,t,n,r,o,i){return"function"==typeof i?D.read(e,t,n,r,o,i):new Promise((i,c)=>{D.read(e,t,n,r,o,(e,t,n)=>{if(e)return c(e);i({bytesRead:t,buffer:n})})})},t.write=function(e,t,...n){return"function"==typeof n[n.length-1]?D.write(e,t,...n):new Promise((r,o)=>{D.write(e,t,...n,(e,t,n)=>{if(e)return o(e);r({bytesWritten:t,buffer:n})})})},"function"==typeof D.realpath.native&&(t.realpath.native=n(D.realpath.native))});const L=/[<>:"|?*]/;var I=function(e){const t=function(e){return(e=m.default.normalize(m.default.resolve(e)).split(m.default.sep)).length>0?e[0]:null}(e);return e=e.replace(t,""),L.test(e)};const $=I,R=parseInt("0777",8),_=I,M=parseInt("0777",8);var C=function e(t,n,r){n&&"object"==typeof n||(n={mode:n});let o=n.mode;const i=n.fs||D;if("win32"===process.platform&&_(t)){const e=new Error(t+" contains invalid WIN32 path characters.");throw e.code="EINVAL",e}void 0===o&&(o=M&~process.umask()),r||(r=null),t=m.default.resolve(t);try{i.mkdirSync(t,o),r=r||t}catch(o){if("ENOENT"===o.code){if(m.default.dirname(t)===t)throw o;r=e(m.default.dirname(t),n,r),e(t,n,r)}else{let e;try{e=i.statSync(t)}catch(e){throw o}if(!e.isDirectory())throw o}}return r};const A=k(function e(t,n,r,o){if("function"==typeof n?(r=n,n={}):n&&"object"==typeof n||(n={mode:n}),"win32"===process.platform&&$(t)){const e=new Error(t+" contains invalid WIN32 path characters.");return e.code="EINVAL",r(e)}let i=n.mode;const c=n.fs||D;void 0===i&&(i=R&~process.umask()),o||(o=null),r=r||function(){},t=m.default.resolve(t),c.mkdir(t,i,i=>{if(!i)return r(null,o=o||t);switch(i.code){case"ENOENT":if(m.default.dirname(t)===t)return r(i);e(m.default.dirname(t),n,(o,i)=>{o?r(o,i):e(t,n,r,i)});break;default:c.stat(t,(e,t)=>{e||!t.isDirectory()?r(i,o):r(null,o)})}})});var J={mkdirs:A,mkdirsSync:C,mkdirp:A,mkdirpSync:C,ensureDir:A,ensureDirSync:C};const q=process.versions.node.split("."),W=Number.parseInt(q[0],10),B=Number.parseInt(q[1],10),Y=Number.parseInt(q[2],10);function U(){if(W>10)return!0;if(10===W){if(B>5)return!0;if(5===B&&Y>=0)return!0}return!1}function G(e,t){const n=m.default.resolve(e).split(m.default.sep).filter(e=>e),r=m.default.resolve(t).split(m.default.sep).filter(e=>e);return n.reduce((e,t,n)=>e&&r[n]===t,!0)}function K(e,t,n){return`Cannot ${n} '${e}' to a subdirectory of itself, '${t}'.`}var z={checkPaths:function(e,t,n,r){!function(e,t,n){U()?D.stat(e,{bigint:!0},(e,r)=>{if(e)return n(e);D.stat(t,{bigint:!0},(e,t)=>e?"ENOENT"===e.code?n(null,{srcStat:r,destStat:null}):n(e):n(null,{srcStat:r,destStat:t}))}):D.stat(e,(e,r)=>{if(e)return n(e);D.stat(t,(e,t)=>e?"ENOENT"===e.code?n(null,{srcStat:r,destStat:null}):n(e):n(null,{srcStat:r,destStat:t}))})}(e,t,(o,i)=>{if(o)return r(o);const{srcStat:c,destStat:s}=i;return s&&s.ino&&s.dev&&s.ino===c.ino&&s.dev===c.dev?r(new Error("Source and destination must not be the same.")):c.isDirectory()&&G(e,t)?r(new Error(K(e,t,n))):r(null,{srcStat:c,destStat:s})})},checkPathsSync:function(e,t,n){const{srcStat:r,destStat:o}=function(e,t){let n,r;n=U()?D.statSync(e,{bigint:!0}):D.statSync(e);try{r=U()?D.statSync(t,{bigint:!0}):D.statSync(t)}catch(e){if("ENOENT"===e.code)return{srcStat:n,destStat:null};throw e}return{srcStat:n,destStat:r}}(e,t);if(o&&o.ino&&o.dev&&o.ino===r.ino&&o.dev===r.dev)throw new Error("Source and destination must not be the same.");if(r.isDirectory()&&G(e,t))throw new Error(K(e,t,n));return{srcStat:r,destStat:o}},checkParentPaths:function e(t,n,r,o,i){const c=m.default.resolve(m.default.dirname(t)),s=m.default.resolve(m.default.dirname(r));if(s===c||s===m.default.parse(s).root)return i();U()?D.stat(s,{bigint:!0},(c,a)=>c?"ENOENT"===c.code?i():i(c):a.ino&&a.dev&&a.ino===n.ino&&a.dev===n.dev?i(new Error(K(t,r,o))):e(t,n,s,o,i)):D.stat(s,(c,a)=>c?"ENOENT"===c.code?i():i(c):a.ino&&a.dev&&a.ino===n.ino&&a.dev===n.dev?i(new Error(K(t,r,o))):e(t,n,s,o,i))},checkParentPathsSync:function e(t,n,r,o){const i=m.default.resolve(m.default.dirname(t)),c=m.default.resolve(m.default.dirname(r));if(c===i||c===m.default.parse(c).root)return;let s;try{s=U()?D.statSync(c,{bigint:!0}):D.statSync(c)}catch(e){if("ENOENT"===e.code)return;throw e}if(s.ino&&s.dev&&s.ino===n.ino&&s.dev===n.dev)throw new Error(K(t,r,o));return e(t,n,c,o)},isSrcSubdir:G};const V=J.mkdirsSync;function X(e,t,n,r){if(!r.filter||r.filter(t,n))return function(e,t,n,r){const o=(r.dereference?D.statSync:D.lstatSync)(t);return o.isDirectory()?function(e,t,n,r,o){if(!t)return function(e,t,n,r){return D.mkdirSync(n),Q(t,n,r),D.chmodSync(n,e.mode)}(e,n,r,o);if(t&&!t.isDirectory())throw new Error(`Cannot overwrite non-directory '${r}' with directory '${n}'.`);return Q(n,r,o)}(o,e,t,n,r):o.isFile()||o.isCharacterDevice()||o.isBlockDevice()?function(e,t,n,r,o){return t?function(e,t,n,r){if(r.overwrite)return D.unlinkSync(n),H(e,t,n,r);if(r.errorOnExist)throw new Error(`'${n}' already exists`)}(e,n,r,o):H(e,n,r,o)}(o,e,t,n,r):o.isSymbolicLink()?function(e,t,n,r){let o=D.readlinkSync(t);if(r.dereference&&(o=m.default.resolve(process.cwd(),o)),e){let e;try{e=D.readlinkSync(n)}catch(e){if("EINVAL"===e.code||"UNKNOWN"===e.code)return D.symlinkSync(o,n);throw e}if(r.dereference&&(e=m.default.resolve(process.cwd(),e)),z.isSrcSubdir(o,e))throw new Error(`Cannot copy '${o}' to a subdirectory of itself, '${e}'.`);if(D.statSync(n).isDirectory()&&z.isSrcSubdir(e,o))throw new Error(`Cannot overwrite '${e}' with '${o}'.`);return function(e,t){return D.unlinkSync(t),D.symlinkSync(e,t)}(o,n)}return D.symlinkSync(o,n)}(e,t,n,r):void 0}(e,t,n,r)}function H(e,t,n,r){return"function"==typeof D.copyFileSync?(D.copyFileSync(t,n),D.chmodSync(n,e.mode),r.preserveTimestamps?function(e,t,n){const r=D.openSync(e,"r+");return D.futimesSync(r,t,n),D.closeSync(r)}(n,e.atime,e.mtime):void 0):function(e,t,n,r){const o=function(e){if("function"==typeof Buffer.allocUnsafe)try{return Buffer.allocUnsafe(e)}catch(t){return new Buffer(e)}return new Buffer(e)}(65536),i=D.openSync(t,"r"),c=D.openSync(n,"w",e.mode);let s=0;for(;s<e.size;){const e=D.readSync(i,o,0,65536,s);D.writeSync(c,o,0,e),s+=e}r.preserveTimestamps&&D.futimesSync(c,e.atime,e.mtime),D.closeSync(i),D.closeSync(c)}(e,t,n,r)}function Q(e,t,n){D.readdirSync(e).forEach(r=>function(e,t,n,r){const o=m.default.join(t,e),i=m.default.join(n,e),{destStat:c}=z.checkPathsSync(o,i,"copy");return X(c,o,i,r)}(r,e,t,n))}var Z,ee={copySync:function(e,t,n){"function"==typeof n&&(n={filter:n}),(n=n||{}).clobber=!("clobber"in n)||!!n.clobber,n.overwrite="overwrite"in n?!!n.overwrite:n.clobber,n.preserveTimestamps&&"ia32"===process.arch&&console.warn("fs-extra: Using the preserveTimestamps option in 32-bit node is not recommended;\n\n    see https://github.com/jprichardson/node-fs-extra/issues/269");const{srcStat:r,destStat:o}=z.checkPathsSync(e,t,"copy");return z.checkParentPathsSync(e,r,t,"copy"),function(e,t,n,r){if(r.filter&&!r.filter(t,n))return;const o=m.default.dirname(n);return D.existsSync(o)||V(o),X(e,t,n,r)}(o,e,t,n)}},te={pathExists:(Z=function(e){return T.access(e).then(()=>!0).catch(()=>!1)},Object.defineProperty(function(){const e=arguments[arguments.length-1];if("function"!=typeof e)return Z.apply(this,arguments);Z.apply(this,arguments).then(t=>e(null,t),e)},"name",{value:Z.name})),pathExistsSync:T.existsSync};const ne=J.mkdirs,re=te.pathExists;function oe(e,t,n,r,o){const i=m.default.dirname(n);re(i,(c,s)=>c?o(c):s?ce(e,t,n,r,o):void ne(i,i=>i?o(i):ce(e,t,n,r,o)))}function ie(e,t,n,r,o,i){Promise.resolve(o.filter(n,r)).then(c=>c?e(t,n,r,o,i):i(),e=>i(e))}function ce(e,t,n,r,o){return r.filter?ie(se,e,t,n,r,o):se(e,t,n,r,o)}function se(e,t,n,r,o){(r.dereference?D.stat:D.lstat)(t,(i,c)=>i?o(i):c.isDirectory()?function(e,t,n,r,o,i){return t?t&&!t.isDirectory()?i(new Error(`Cannot overwrite non-directory '${r}' with directory '${n}'.`)):le(n,r,o,i):function(e,t,n,r,o){D.mkdir(n,i=>{if(i)return o(i);le(t,n,r,t=>t?o(t):D.chmod(n,e.mode,o))})}(e,n,r,o,i)}(c,e,t,n,r,o):c.isFile()||c.isCharacterDevice()||c.isBlockDevice()?function(e,t,n,r,o,i){return t?function(e,t,n,r,o){if(!r.overwrite)return r.errorOnExist?o(new Error(`'${n}' already exists`)):o();D.unlink(n,i=>i?o(i):ae(e,t,n,r,o))}(e,n,r,o,i):ae(e,n,r,o,i)}(c,e,t,n,r,o):c.isSymbolicLink()?function(e,t,n,r,o){D.readlink(t,(t,i)=>t?o(t):(r.dereference&&(i=m.default.resolve(process.cwd(),i)),e?void D.readlink(n,(t,c)=>t?"EINVAL"===t.code||"UNKNOWN"===t.code?D.symlink(i,n,o):o(t):(r.dereference&&(c=m.default.resolve(process.cwd(),c)),z.isSrcSubdir(i,c)?o(new Error(`Cannot copy '${i}' to a subdirectory of itself, '${c}'.`)):e.isDirectory()&&z.isSrcSubdir(c,i)?o(new Error(`Cannot overwrite '${c}' with '${i}'.`)):function(e,t,n){D.unlink(t,r=>r?n(r):D.symlink(e,t,n))}(i,n,o))):D.symlink(i,n,o)))}(e,t,n,r,o):void 0)}function ae(e,t,n,r,o){return"function"==typeof D.copyFile?D.copyFile(t,n,t=>t?o(t):ue(e,n,r,o)):function(e,t,n,r,o){const i=D.createReadStream(t);i.on("error",e=>o(e)).once("open",()=>{const t=D.createWriteStream(n,{mode:e.mode});t.on("error",e=>o(e)).on("open",()=>i.pipe(t)).once("close",()=>ue(e,n,r,o))})}(e,t,n,r,o)}function ue(e,t,n,r){D.chmod(t,e.mode,o=>o?r(o):n.preserveTimestamps?function(e,t,n,r){D.open(e,"r+",(e,o)=>{if(e)return r(e);D.futimes(o,t,n,e=>{D.close(o,t=>{r&&r(e||t)})})})}(t,e.atime,e.mtime,r):r())}function le(e,t,n,r){D.readdir(e,(o,i)=>o?r(o):fe(i,e,t,n,r))}function fe(e,t,n,r,o){const i=e.pop();return i?function(e,t,n,r,o,i){const c=m.default.join(n,t),s=m.default.join(r,t);z.checkPaths(c,s,"copy",(t,a)=>{if(t)return i(t);const{destStat:u}=a;ce(u,c,s,o,t=>t?i(t):fe(e,n,r,o,i))})}(e,i,t,n,r,o):o()}var de={copy:k(function(e,t,n,r){"function"!=typeof n||r?"function"==typeof n&&(n={filter:n}):(r=n,n={}),r=r||function(){},(n=n||{}).clobber=!("clobber"in n)||!!n.clobber,n.overwrite="overwrite"in n?!!n.overwrite:n.clobber,n.preserveTimestamps&&"ia32"===process.arch&&console.warn("fs-extra: Using the preserveTimestamps option in 32-bit node is not recommended;\n\n    see https://github.com/jprichardson/node-fs-extra/issues/269"),z.checkPaths(e,t,"copy",(o,i)=>{if(o)return r(o);const{srcStat:c,destStat:s}=i;z.checkParentPaths(e,c,t,"copy",o=>o?r(o):n.filter?ie(oe,s,e,t,n,r):oe(s,e,t,n,r))})})};const pe="win32"===process.platform;function ye(e){["unlink","chmod","stat","lstat","rmdir","readdir"].forEach(t=>{e[t]=e[t]||D[t],e[t+="Sync"]=e[t]||D[t]}),e.maxBusyTries=e.maxBusyTries||3}function he(e,t,n){let r=0;"function"==typeof t&&(n=t,t={}),h.default(e,"rimraf: missing path"),h.default.strictEqual(typeof e,"string","rimraf: path should be a string"),h.default.strictEqual(typeof n,"function","rimraf: callback function required"),h.default(t,"rimraf: invalid options argument provided"),h.default.strictEqual(typeof t,"object","rimraf: options should be object"),ye(t),me(e,t,function o(i){if(i){if(("EBUSY"===i.code||"ENOTEMPTY"===i.code||"EPERM"===i.code)&&r<t.maxBusyTries)return r++,setTimeout(()=>me(e,t,o),100*r);"ENOENT"===i.code&&(i=null)}n(i)})}function me(e,t,n){h.default(e),h.default(t),h.default("function"==typeof n),t.lstat(e,(r,o)=>r&&"ENOENT"===r.code?n(null):r&&"EPERM"===r.code&&pe?Se(e,t,r,n):o&&o.isDirectory()?ge(e,t,r,n):void t.unlink(e,r=>{if(r){if("ENOENT"===r.code)return n(null);if("EPERM"===r.code)return pe?Se(e,t,r,n):ge(e,t,r,n);if("EISDIR"===r.code)return ge(e,t,r,n)}return n(r)}))}function Se(e,t,n,r){h.default(e),h.default(t),h.default("function"==typeof r),n&&h.default(n instanceof Error),t.chmod(e,438,o=>{o?r("ENOENT"===o.code?null:n):t.stat(e,(o,i)=>{o?r("ENOENT"===o.code?null:n):i.isDirectory()?ge(e,t,n,r):t.unlink(e,r)})})}function ve(e,t,n){let r;h.default(e),h.default(t),n&&h.default(n instanceof Error);try{t.chmodSync(e,438)}catch(e){if("ENOENT"===e.code)return;throw n}try{r=t.statSync(e)}catch(e){if("ENOENT"===e.code)return;throw n}r.isDirectory()?we(e,t,n):t.unlinkSync(e)}function ge(e,t,n,r){h.default(e),h.default(t),n&&h.default(n instanceof Error),h.default("function"==typeof r),t.rmdir(e,o=>{!o||"ENOTEMPTY"!==o.code&&"EEXIST"!==o.code&&"EPERM"!==o.code?r(o&&"ENOTDIR"===o.code?n:o):function(e,t,n){h.default(e),h.default(t),h.default("function"==typeof n),t.readdir(e,(r,o)=>{if(r)return n(r);let i,c=o.length;if(0===c)return t.rmdir(e,n);o.forEach(r=>{he(m.default.join(e,r),t,r=>{if(!i)return r?n(i=r):void(0==--c&&t.rmdir(e,n))})})})}(e,t,r)})}function Ee(e,t){let n;ye(t=t||{}),h.default(e,"rimraf: missing path"),h.default.strictEqual(typeof e,"string","rimraf: path should be a string"),h.default(t,"rimraf: missing options"),h.default.strictEqual(typeof t,"object","rimraf: options should be object");try{n=t.lstatSync(e)}catch(n){if("ENOENT"===n.code)return;"EPERM"===n.code&&pe&&ve(e,t,n)}try{n&&n.isDirectory()?we(e,t,null):t.unlinkSync(e)}catch(n){if("ENOENT"===n.code)return;if("EPERM"===n.code)return pe?ve(e,t,n):we(e,t,n);if("EISDIR"!==n.code)throw n;we(e,t,n)}}function we(e,t,n){h.default(e),h.default(t),n&&h.default(n instanceof Error);try{t.rmdirSync(e)}catch(r){if("ENOTDIR"===r.code)throw n;if("ENOTEMPTY"===r.code||"EEXIST"===r.code||"EPERM"===r.code)!function(e,t){if(h.default(e),h.default(t),t.readdirSync(e).forEach(n=>Ee(m.default.join(e,n),t)),!pe)return t.rmdirSync(e,t);{const n=Date.now();do{try{return t.rmdirSync(e,t)}catch(e){}}while(Date.now()-n<500)}}(e,t);else if("ENOENT"!==r.code)throw r}}var be=he;he.sync=Ee;var ke={remove:k(be),removeSync:be.sync};const Oe=k(function(e,t){t=t||function(){},D.readdir(e,(n,r)=>{if(n)return J.mkdirs(e,t);r=r.map(t=>m.default.join(e,t)),function e(){const n=r.pop();if(!n)return t();ke.remove(n,n=>{if(n)return t(n);e()})}()})});function je(e){let t;try{t=D.readdirSync(e)}catch(t){return J.mkdirsSync(e)}t.forEach(t=>{t=m.default.join(e,t),ke.removeSync(t)})}var Ne={emptyDirSync:je,emptydirSync:je,emptyDir:Oe,emptydir:Oe};const Fe=te.pathExists;var xe={createFile:k(function(e,t){function n(){D.writeFile(e,"",e=>{if(e)return t(e);t()})}D.stat(e,(r,o)=>{if(!r&&o.isFile())return t();const i=m.default.dirname(e);Fe(i,(e,r)=>e?t(e):r?n():void J.mkdirs(i,e=>{if(e)return t(e);n()}))})}),createFileSync:function(e){let t;try{t=D.statSync(e)}catch(e){}if(t&&t.isFile())return;const n=m.default.dirname(e);D.existsSync(n)||J.mkdirsSync(n),D.writeFileSync(e,"")}};const Pe=te.pathExists;var De={createLink:k(function(e,t,n){function r(e,t){D.link(e,t,e=>{if(e)return n(e);n(null)})}Pe(t,(o,i)=>o?n(o):i?n(null):void D.lstat(e,o=>{if(o)return o.message=o.message.replace("lstat","ensureLink"),n(o);const i=m.default.dirname(t);Pe(i,(o,c)=>o?n(o):c?r(e,t):void J.mkdirs(i,o=>{if(o)return n(o);r(e,t)}))}))}),createLinkSync:function(e,t){if(D.existsSync(t))return;try{D.lstatSync(e)}catch(e){throw e.message=e.message.replace("lstat","ensureLink"),e}const n=m.default.dirname(t);return D.existsSync(n)||J.mkdirsSync(n),D.linkSync(e,t)}};const Te=te.pathExists,Le=J.mkdirs,Ie=J.mkdirsSync,$e=te.pathExists;var Re,_e={createSymlink:k(function(e,t,n,r){r="function"==typeof n?n:r,n="function"!=typeof n&&n,$e(t,(o,i)=>o?r(o):i?r(null):void function(e,t,n){if(m.default.isAbsolute(e))return D.lstat(e,t=>t?(t.message=t.message.replace("lstat","ensureSymlink"),n(t)):n(null,{toCwd:e,toDst:e}));{const r=m.default.dirname(t),o=m.default.join(r,e);Te(o,(t,i)=>t?n(t):i?n(null,{toCwd:o,toDst:e}):D.lstat(e,t=>t?(t.message=t.message.replace("lstat","ensureSymlink"),n(t)):n(null,{toCwd:e,toDst:m.default.relative(r,e)})))}}(e,t,(o,i)=>{if(o)return r(o);e=i.toDst,function(e,t,n){if(n="function"==typeof t?t:n,t="function"!=typeof t&&t)return n(null,t);D.lstat(e,(e,r)=>{if(e)return n(null,"file");t=r&&r.isDirectory()?"dir":"file",n(null,t)})}(i.toCwd,n,(n,o)=>{if(n)return r(n);const i=m.default.dirname(t);$e(i,(n,c)=>n?r(n):c?D.symlink(e,t,o,r):void Le(i,n=>{if(n)return r(n);D.symlink(e,t,o,r)}))})}))}),createSymlinkSync:function(e,t,n){if(D.existsSync(t))return;const r=function(e,t){let n;if(m.default.isAbsolute(e)){if(n=D.existsSync(e),!n)throw new Error("absolute srcpath does not exist");return{toCwd:e,toDst:e}}{const r=m.default.dirname(t),o=m.default.join(r,e);if(n=D.existsSync(o),n)return{toCwd:o,toDst:e};if(n=D.existsSync(e),!n)throw new Error("relative srcpath does not exist");return{toCwd:e,toDst:m.default.relative(r,e)}}}(e,t);e=r.toDst,n=function(e,t){let n;if(t)return t;try{n=D.lstatSync(e)}catch(e){return"file"}return n&&n.isDirectory()?"dir":"file"}(r.toCwd,n);const o=m.default.dirname(t);return D.existsSync(o)||Ie(o),D.symlinkSync(e,t,n)}},Me={createFile:xe.createFile,createFileSync:xe.createFileSync,ensureFile:xe.createFile,ensureFileSync:xe.createFileSync,createLink:De.createLink,createLinkSync:De.createLinkSync,ensureLink:De.createLink,ensureLinkSync:De.createLinkSync,createSymlink:_e.createSymlink,createSymlinkSync:_e.createSymlinkSync,ensureSymlink:_e.createSymlink,ensureSymlinkSync:_e.createSymlinkSync};try{Re=D}catch(e){Re=f.default}function Ce(e,t){var n,r="\n";return"object"==typeof t&&null!==t&&(t.spaces&&(n=t.spaces),t.EOL&&(r=t.EOL)),JSON.stringify(e,t?t.replacer:null,n).replace(/\n/g,r)+r}function Ae(e){return Buffer.isBuffer(e)&&(e=e.toString("utf8")),e.replace(/^\uFEFF/,"")}var Je={readFile:function(e,t,n){null==n&&(n=t,t={}),"string"==typeof t&&(t={encoding:t});var r=!0;"throws"in(t=t||{})&&(r=t.throws),(t.fs||Re).readFile(e,t,function(o,i){if(o)return n(o);var c;i=Ae(i);try{c=JSON.parse(i,t?t.reviver:null)}catch(t){return r?(t.message=e+": "+t.message,n(t)):n(null,null)}n(null,c)})},readFileSync:function(e,t){"string"==typeof(t=t||{})&&(t={encoding:t});var n=t.fs||Re,r=!0;"throws"in t&&(r=t.throws);try{var o=n.readFileSync(e,t);return o=Ae(o),JSON.parse(o,t.reviver)}catch(t){if(r)throw t.message=e+": "+t.message,t;return null}},writeFile:function(e,t,n,r){null==r&&(r=n,n={});var o=(n=n||{}).fs||Re,i="";try{i=Ce(t,n)}catch(e){return void(r&&r(e,null))}o.writeFile(e,i,n,r)},writeFileSync:function(e,t,n){var r=(n=n||{}).fs||Re,o=Ce(t,n);return r.writeFileSync(e,o,n)}};const qe=k;var We={readJson:qe(Je.readFile),readJsonSync:Je.readFileSync,writeJson:qe(Je.writeFile),writeJsonSync:Je.writeFileSync};const Be=te.pathExists;We.outputJson=k(function(e,t,n,r){"function"==typeof n&&(r=n,n={});const o=m.default.dirname(e);Be(o,(i,c)=>i?r(i):c?We.writeJson(e,t,n,r):void J.mkdirs(o,o=>{if(o)return r(o);We.writeJson(e,t,n,r)}))}),We.outputJsonSync=function(e,t,n){const r=m.default.dirname(e);D.existsSync(r)||J.mkdirsSync(r),We.writeJsonSync(e,t,n)},We.outputJSON=We.outputJson,We.outputJSONSync=We.outputJsonSync,We.writeJSON=We.writeJson,We.writeJSONSync=We.writeJsonSync,We.readJSON=We.readJson,We.readJSONSync=We.readJsonSync;var Ye=We;const Ue=ee.copySync,Ge=ke.removeSync,Ke=J.mkdirpSync;function ze(e,t,n){try{D.renameSync(e,t)}catch(r){if("EXDEV"!==r.code)throw r;return function(e,t,n){return Ue(e,t,{overwrite:n,errorOnExist:!0}),Ge(e)}(e,t,n)}}var Ve={moveSync:function(e,t,n){const r=(n=n||{}).overwrite||n.clobber||!1,{srcStat:o}=z.checkPathsSync(e,t,"move");return z.checkParentPathsSync(e,o,t,"move"),Ke(m.default.dirname(t)),function(e,t,n){if(n)return Ge(t),ze(e,t,n);if(D.existsSync(t))throw new Error("dest already exists.");return ze(e,t,n)}(e,t,r)}};const Xe=de.copy,He=ke.remove,Qe=J.mkdirp,Ze=te.pathExists;function et(e,t,n,r){D.rename(e,t,o=>o?"EXDEV"!==o.code?r(o):function(e,t,n,r){Xe(e,t,{overwrite:n,errorOnExist:!0},t=>t?r(t):He(e,r))}(e,t,n,r):r())}var tt={move:k(function(e,t,n,r){"function"==typeof n&&(r=n,n={});const o=n.overwrite||n.clobber||!1;z.checkPaths(e,t,"move",(n,i)=>{if(n)return r(n);const{srcStat:c}=i;z.checkParentPaths(e,c,t,"move",n=>{if(n)return r(n);Qe(m.default.dirname(t),n=>n?r(n):function(e,t,n,r){if(n)return He(t,o=>o?r(o):et(e,t,n,r));Ze(t,(o,i)=>o?r(o):i?r(new Error("dest already exists.")):et(e,t,n,r))}(e,t,o,r))})})})};const nt=te.pathExists;var rt={outputFile:k(function(e,t,n,r){"function"==typeof n&&(r=n,n="utf8");const o=m.default.dirname(e);nt(o,(i,c)=>i?r(i):c?D.writeFile(e,t,n,r):void J.mkdirs(o,o=>{if(o)return r(o);D.writeFile(e,t,n,r)}))}),outputFileSync:function(e,...t){const n=m.default.dirname(e);if(D.existsSync(n))return D.writeFileSync(e,...t);J.mkdirsSync(n),D.writeFileSync(e,...t)}},ot=b(function(e){e.exports=Object.assign({},T,ee,de,Ne,Me,Ye,J,Ve,tt,rt,te,ke),Object.getOwnPropertyDescriptor(f.default,"promises")&&Object.defineProperty(e.exports,"promises",{get:()=>f.default.promises})});function it(e){const t=e.dependencies||{};return void 0!==t.react&&void 0!==t["react-dom"]}process.on("unhandledRejection",e=>{throw e}),module.exports=function(e,t,n,r,o){const i=require(m.default.join(e,"package.json")),c=ot.existsSync(m.default.join(e,"yarn.lock"));if(!o)return console.log(""),console.error(`A template was not provided. This is likely because you're using an outdated version of ${v.default.cyan("create-jxa-app")}.`),console.error(`Please note that global installs of ${v.default.cyan("create-jxa-app")} are no longer supported.`),void console.error(`You can fix this by running ${v.default.cyan("npm uninstall -g create-jxa-app")} or ${v.default.cyan("yarn global remove create-jxa-app")} before using ${v.default.cyan("create-jxa-app")} again.`);const s=m.default.dirname(require.resolve(`${o}/package.json`,{paths:[e]})),u=m.default.join(s,"template.json");let l={};ot.existsSync(u)&&(l=require(u));const f=l.package||{};(l.dependencies||l.scripts)&&(console.log(),console.log(v.default.yellow("Root-level `dependencies` and `scripts` keys in `template.json` are deprecated.\nThis template should be updated to use the new `package` key.")),console.log("For more information, visit https://https://github.com/aheissenberger/macos-jxa-bundler/create-jxa-app/#templates")),l.dependencies&&(f.dependencies=l.dependencies),l.scripts&&(f.scripts=l.scripts);const d=["name","version","description","keywords","bugs","license","author","contributors","files","browser","bin","man","directories","repository","peerDependencies","bundledDependencies","optionalDependencies","engineStrict","os","cpu","preferGlobal","private","publishConfig"],p=["dependencies","scripts"],y=Object.keys(f).filter(e=>!d.includes(e)&&!p.includes(e));i.dependencies=i.dependencies||{},i.scripts=Object.assign({dev:"jxabundler watch",build:"jxabundler",test:"jest"},f.scripts||{}),c&&(i.scripts=Object.entries(i.scripts).reduce((e,[t,n])=>E({},e,{[t]:n.replace(/(npm run |npm )/,"yarn ")}),{})),i.eslintConfig={extends:"react-app"},y.forEach(e=>{i[e]=f[e]}),ot.writeFileSync(m.default.join(e,"package.json"),JSON.stringify(i,null,2)+S.default.EOL);const h=ot.existsSync(m.default.join(e,"README.md"));h&&ot.renameSync(m.default.join(e,"README.md"),m.default.join(e,"README.old.md"));const w=m.default.join(s,"template");if(!ot.existsSync(w))return void console.error(`Could not locate supplied template: ${v.default.green(w)}`);if(ot.copySync(w,e),c)try{const t=ot.readFileSync(m.default.join(e,"README.md"),"utf8");ot.writeFileSync(m.default.join(e,"README.md"),t.replace(/(npm run |npm )/g,"yarn "),"utf8")}catch(e){}if(ot.existsSync(m.default.join(e,".gitignore"))){const t=ot.readFileSync(m.default.join(e,"gitignore"));ot.appendFileSync(m.default.join(e,".gitignore"),t),ot.unlinkSync(m.default.join(e,"gitignore"))}else ot.moveSync(m.default.join(e,"gitignore"),m.default.join(e,".gitignore"),[]);let b,k,O,j=!1;(function(){try{return a.execSync("git --version",{stdio:"ignore"}),!function(){try{return a.execSync("git rev-parse --is-inside-work-tree",{stdio:"ignore"}),!0}catch(e){return!1}}()&&!function(){try{return a.execSync("hg --cwd . root",{stdio:"ignore"}),!0}catch(e){return!1}}()&&(a.execSync("git init",{stdio:"ignore"}),!0)}catch(e){return console.warn("Git repo not initialized",e),!1}})()&&(j=!0,console.log(),console.log("Initialized a git repository.")),c?(b="yarnpkg",k="remove",O=["add"]):(b="npm",k="uninstall",O=["install","--save",n&&"--verbose"].filter(e=>e));const N=Object.entries(E({},f.dependencies,f.devDependencies));if(N.length&&(O=O.concat(N.map(([e,t])=>`${e}@${t}`))),it(i)||(O=O.concat(["react","react-dom"])),(!it(i)||o)&&O.length>1&&(console.log(),console.log(`Installing template dependencies using ${b}...`),0!==g.default.sync(b,O,{stdio:"inherit"}).status))return void console.error(`\`${b} ${O.join(" ")}\` failed`);if(O.find(e=>e.includes("typescript"))&&console.log(),console.log(`Removing template package using ${b}...`),console.log(),0!==g.default.sync(b,[k,o],{stdio:"inherit"}).status)return void console.error(`\`${b} ${O.join(" ")}\` failed`);let F;j&&function(e){try{return a.execSync("git add -A",{stdio:"ignore"}),a.execSync('git commit -m "Initialize project using Create JXA App"',{stdio:"ignore"}),!0}catch(t){console.warn("Git commit not created",t),console.warn("Removing .git directory...");try{ot.removeSync(m.default.join(e,".git"))}catch(e){}return!1}}(e)&&(console.log(),console.log("Created git commit.")),F=r&&m.default.join(r,t)===e?t:e;const x=c?"yarn":"npm";console.log(),console.log(`Success! Created ${t} at ${e}`),console.log("Inside that directory, you can run several commands:"),console.log(),console.log(v.default.cyan(`  ${x} start`)),console.log("    Starts the development server."),console.log(),console.log(v.default.cyan(`  ${x} ${c?"":"run "}build`)),console.log("    Bundles the app into static files for production."),console.log(),console.log(v.default.cyan(`  ${x} test`)),console.log("    Starts the test runner."),console.log(),console.log(v.default.cyan(`  ${x} ${c?"":"run "}eject`)),console.log("    Removes this tool and copies build dependencies, configuration files"),console.log("    and scripts into the app directory. If you do this, you can’t go back!"),console.log(),console.log("We suggest that you begin by typing:"),console.log(),console.log(v.default.cyan("  cd"),F),console.log(`  ${v.default.cyan(`${x} start`)}`),h&&(console.log(),console.log(v.default.yellow("You had a `README.md` file, we renamed it to `README.old.md`"))),console.log(),console.log("Happy hacking!")};
